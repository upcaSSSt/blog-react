import{w as u}from"./with-props-BITBR5i4.js";import{v as h,t as x,a as n,o as s,L as f}from"./chunk-D4RADZKF-F8gbsHt2.js";import{C as j}from"./global-DqGd4opN.js";import{F as g}from"./form-B96bbkt8.js";const N=u(function(){var c;const{id:o}=h(),d=x(),{curUser:l}=n.useContext(j),[a,i]=n.useState({});n.useEffect(()=>{(async()=>{const e=await(await fetch(`http://localhost:3000/api/v1/posts/${o}`)).json();i(e)})()},[]);async function m(t,e){await fetch(`http://localhost:3000/api/v1/purge_image/${t}`,{method:"delete"});const r=window.structuredClone(a);r.images.splice(e,1),i(r)}async function p(){await fetch(`http://localhost:3000/api/v1/posts/${o}`,{method:"delete"}),d("/")}return s.jsx("section",{className:"section",children:l.id===a.user_id?s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"post__imgs",children:(c=a.images)==null?void 0:c.map((t,e)=>s.jsxs("figure",{className:"post__img",children:[s.jsx("img",{src:t.url,alt:"PostImg"}),s.jsx("button",{className:"btn btn_red",onClick:()=>m(t.id,e),children:"Удалить"},t.id)]},t.id))}),s.jsx(g,{url:`posts/${o}`,method:"put",body:a.body}),s.jsx("button",{className:"btn btn_red",onClick:p,children:"Удалить"})]}):s.jsxs(s.Fragment,{children:[s.jsx("p",{children:"Вы не являетесь создателем"}),s.jsx(f,{className:"btn",to:`/posts/${o}`,children:"Назад"})]})})});export{N as default};
