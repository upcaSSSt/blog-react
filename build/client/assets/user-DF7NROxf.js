import{w as x}from"./with-props-BITBR5i4.js";import{v as b,t as N,a as r,o as t,L as g}from"./chunk-D4RADZKF-F8gbsHt2.js";import{C as v}from"./global-DqGd4opN.js";import{C as y}from"./card-CeJAm_5I.js";import{P as $}from"./post-tiVzxYm2.js";import"./ava-C2JHgPho.js";const L=x(function(){var d;const{id:s}=b(),p=N(),{curUser:e,setCurUser:f}=r.useContext(v),[l,w]=r.useState({}),[C,u]=r.useState(null),i=r.useRef([]);r.useEffect(()=>{(async()=>{const h=await(await fetch(`http://localhost:3000/api/v1/users/${s}`)).json();w(h);const c=await fetch(`http://localhost:3000/api/v1/users/${e.id}/chats`);i.current=await c.json(),i.current.some(a=>(console.log(!a.users.some(o=>(console.log(o.id,s,o.id==s),o.id==s))),!a.name&&!a.users.some(o=>o.id==s))),i.current.some(a=>!a.name&&!a.users.some(o=>o.id==s))&&u(t.jsx("button",{className:"btn",onClick:j,children:"Чат"}))})()},[]);async function m(n){const c=await(await fetch(`http://localhost:3000/users/${e.id}/follow/${s}/${n}.json`,{method:"post"})).json();f({...e,following_ids:c}),p("/")}async function j(){u(null),await fetch(`http://localhost:3000/api/v1/users/${e.id}/chats`,{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:null,users_ids:[+s]})})}return t.jsxs("section",{className:"section",children:[t.jsx(y,{id:s,name:l.name}),t.jsxs("div",{className:"row",children:[e.name&&(e.id==s&&t.jsx(g,{className:"btn",to:"/new",children:"Пост"})||e.following_ids.includes(+s)&&t.jsx("button",{className:"btn btn_red",onClick:()=>m(!1),children:"Отписаться"})||t.jsx("button",{className:"btn",onClick:()=>m(!0),children:"Подписаться"})),C]}),(d=l.posts)==null?void 0:d.map(n=>t.jsx($,{post:n},n.id))]})});export{L as default};
